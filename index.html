<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cravers</title>

  <!-- iOS PWA fullscreen -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <!-- tu uÅ¼ywasz pliku z repo root -->
  <link rel="apple-touch-icon" href="/icon-192.png" />

  <!-- Manifest PWA -->
  <link rel="manifest" href="/manifest.json" />

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .tile { transition: transform .12s ease, box-shadow .12s ease; }
    .tile:active, .tile:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,.15); }
  </style>
</head>
<body class="min-h-screen bg-slate-950 text-slate-50">
  <!-- LOCK: PIN narzucony z gÃ³ry -->
  <div id="cr_lock" class="fixed inset-0 flex items-center justify-center bg-black/90 z-[9999]">
    <div class="w-[360px] max-w-[92%] p-6 rounded-xl bg-slate-900 text-center shadow-2xl">
      <img src="/icon-192.png" class="w-14 mx-auto mb-2 rounded-lg" alt="">
      <h2 class="text-lg font-semibold mb-2">Cravers â€” dostÄ™p</h2>
      <div id="loginWrap">
        <p class="text-xs text-slate-400 mb-2">Wpisz PIN</p>
        <input id="pinInput" inputmode="numeric" placeholder="PIN"
               class="w-full text-lg px-3 py-2 rounded-lg bg-slate-800 border border-white/10 mb-2 outline-none">
        <label class="flex items-center justify-center gap-2 text-xs text-slate-400 mb-2 select-none">
          <input id="rememberCheck" type="checkbox"> ZapamiÄ™taj na 30 dni
        </label>
        <div class="flex justify-center gap-2">
          <button id="unlockBtn" class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 font-semibold">WejdÅº</button>
          <button id="logoutBtn" class="px-4 py-2 rounded-lg bg-slate-700">Wyloguj</button>
        </div>
        <p id="lockMsg" class="mt-2 text-rose-300 text-sm"></p>
      </div>
      <p class="mt-3 text-xs text-slate-500">ZapomniaÅ‚eÅ› PIN? WyczyÅ›Ä‡ dane witryny / localStorage.</p>
    </div>
  </div>

  <!-- APP -->
  <div class="mx-auto max-w-5xl px-4 py-6 sm:py-10">
    <main id="view" class="mt-0"></main>
  </div>

  <script>
    /************* KONFIG LINKÃ“W *************
     * TU PODMIENIASZ TYLKO URL-E
     *****************************************/
    const LINKS = {
      oferty: {
        wesele: {
      2026: 'https://drive.google.com/file/d/12nC-tLsALrsNhSn4K_OqL4fIllUspLPR/preview',
      2027: 'https://drive.google.com/file/d/1i58nooBe62mBEiqPWiay5EvIFHHnOAuO/preview',
      2028: 'https://drive.google.com/file/d/1PUBO75O_clReMCjICj28PsCyjSdMKXiL/preview',
    },
        },
        studniowka: {
          2026: '', // TODO: wklej link
          2027: '', // TODO: wklej link
          2028: '', // TODO: wklej link
        },
      },
      podpisz: {
        weselna: 'https://docs.google.com/forms/d/e/1FAIpQLSeqM0EvJmnepVRwYDc_mZ9ngosOVM_di0MohkLFo2x7xKJdfA/viewform?embedded=true',
        inna:    'https://docs.google.com/forms/d/e/1FAIpQLSeqM0EvJmnepVRwYDc_mZ9ngosOVM_di0MohkLFo2x7xKJdfA/viewform?embedded=true',
      },
      pozostale: {
        ustalenia:  '', // PDF z przykÅ‚adowymi ustaleniami
        scenariusz: ''  // PDF z przykÅ‚adowym scenariuszem
      }
    };
    /*****************************************/

    // POMOCNIKI UI
    const el = (tag, cls, html) => {
      const e = document.createElement(tag);
      if (cls) e.className = cls;
      if (html != null) e.innerHTML = html;
      return e;
    };

    function tile(label, sub, onclick, gradient='from-sky-600 to-sky-800', emoji='ðŸ“„') {
      const b = el('button', `tile rounded-3xl bg-gradient-to-br ${gradient} p-5 text-left w-full`);
      b.onclick = onclick;
      b.append(el('div', 'text-3xl', emoji));
      b.append(el('div', 'mt-2 text-lg font-semibold', label));
      if (sub) b.append(el('div', 'text-white/80 text-sm', sub));
      return b;
    }

    function makeActionButton(text, variant='primary') {
      const base = 'px-3 py-1.5 rounded-lg text-sm font-medium transition';
      let cls = base + ' ';
      if (variant === 'primary') cls += 'bg-emerald-600 hover:bg-emerald-500';
      else if (variant === 'secondary') cls += 'bg-slate-800 hover:bg-slate-700';
      else cls += 'bg-slate-900 hover:bg-slate-800';
      const b = el('button', cls, text);
      return b;
    }

    function rowWithActions(label, url) {
      if (!url) {
        const box = el(
          'div',
          'rounded-2xl bg-slate-900/40 p-4 text-xs sm:text-sm text-slate-500 border border-dashed border-slate-700',
          label + ' â€” brak linku (uzupeÅ‚nij w LINKS w index.html)'
        );
        return box;
      }

      const box = el('div', 'rounded-2xl bg-slate-900/80 p-4 space-y-3 shadow');
      box.append(el('div', 'text-sm sm:text-base font-semibold', label));

      const btnRow = el('div', 'flex flex-wrap gap-2');
      const openBtn  = makeActionButton('OtwÃ³rz', 'primary');
      const copyBtn  = makeActionButton('Kopiuj link', 'secondary');
      const printBtn = makeActionButton('Drukuj', 'ghost');

      openBtn.onclick  = () => openInViewer(url, 'open');
      copyBtn.onclick  = () => copyLink(url);
      printBtn.onclick = () => openInViewer(url, 'print');

      btnRow.append(openBtn, copyBtn, printBtn);
      box.append(btnRow);
      return box;
    }

    function section(title) {
      const d = el('div', 'mb-6');
      d.append(el('h3', 'text-base font-semibold mb-2', title));
      return d;
    }

    const view = document.getElementById('view');

    // ROUTER
    function go(hash){ location.hash = hash; }
    window.addEventListener('hashchange', render);
    render();

    function render(){
      const h = location.hash || '#/';
      view.innerHTML = '';

      if (h === '#/' || h === '#')        return renderHome();
      if (h === '#/oferty')              return renderOferty();
      if (h.startsWith('#/oferty/wesele'))      return renderOfertyRok('wesele');
      if (h.startsWith('#/oferty/studniowka'))  return renderOfertyRok('studniowka');
      if (h === '#/podpisz')             return renderPodpisz();
      if (h === '#/pozostale')           return renderPozostale();

      view.textContent = 'Nie znaleziono strony.';
    }

    function renderHome(){
      const grid = el('div','grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3');
      grid.append(
        tile('Oferty','Wesele / StudniÃ³wka', ()=>go('#/oferty'),'from-sky-600 to-sky-800','ðŸ’¼'),
        tile('Podpisz umowÄ™','Formularze Google', ()=>go('#/podpisz'),'from-emerald-600 to-emerald-800','âœï¸'),
        tile('PozostaÅ‚e','Ustalenia / Scenariusz', ()=>go('#/pozostale'),'from-amber-600 to-amber-800','ðŸ§·')
      );
      view.append(grid);
    }

    function renderOferty(){
      const grid = el('div','grid grid-cols-1 gap-4 sm:grid-cols-2');
      grid.append(
        tile('Wesele','2026 / 2027 / 2028', ()=>go('#/oferty/wesele'),'from-indigo-600 to-indigo-800','ðŸ’’'),
        tile('StudniÃ³wka','2026 / 2027 / 2028', ()=>go('#/oferty/studniowka'),'from-rose-600 to-rose-800','ðŸŽ“')
      );
      view.append(grid);
    }

    function renderOfertyRok(type){
      const nice = type === 'wesele' ? 'Wesele' : 'StudniÃ³wka';
      view.append(el('h2','text-xl font-semibold mb-4', `Oferty â€” ${nice}`));

      const wrap = el('div','space-y-3');
      const years = Object.keys(LINKS.oferty[type] || {}).sort();
      years.forEach(y => {
        const url = LINKS.oferty[type][y];
        wrap.append(rowWithActions(`${nice} ${y}`, url));
      });
      view.append(wrap);
    }

    function renderPodpisz(){
      view.append(el('h2','text-xl font-semibold mb-4','Podpisz umowÄ™'));
      const wrap = el('div','space-y-3');
      wrap.append(rowWithActions('Umowa weselna', LINKS.podpisz.weselna));
      wrap.append(rowWithActions('Umowa inna',    LINKS.podpisz.inna));
      view.append(wrap);
    }

    function renderPozostale(){
      view.append(el('h2','text-xl font-semibold mb-4','PozostaÅ‚e materiaÅ‚y'));
      const wrap = el('div','space-y-3');
      wrap.append(rowWithActions('PrzykÅ‚adowe ustalenia',  LINKS.pozostale.ustalenia));
      wrap.append(rowWithActions('PrzykÅ‚adowy scenariusz', LINKS.pozostale.scenariusz));
      view.append(wrap);
    }

    // viewer fullscreen (pdf/formularz)
    function openInViewer(url, mode = 'open'){
      if (!url) return alert('Brak linku.');
      const target = `viewer.html?src=${encodeURIComponent(url)}&mode=${encodeURIComponent(mode)}`;
      location.href = target;
    }

    async function copyLink(url){
      if (!url) return alert('Brak linku.');
      try {
        await navigator.clipboard.writeText(url);
        toast('Skopiowano link âœ…');
      } catch {
        prompt('Skopiuj rÄ™cznie:', url);
      }
    }

    function toast(txt){
      const t = el('div','fixed bottom-4 left-1/2 -translate-x-1/2 bg-slate-900/90 text-white px-4 py-2 rounded-xl ring-1 ring-white/10 shadow text-sm');
      t.textContent = txt; document.body.append(t);
      setTimeout(()=>t.remove(), 1800);
    }

    /******************* PIN (narzucony) â€” zapamiÄ™taj 30 dni *******************/
    async function sha256hex(msg) {
      const enc = new TextEncoder();
      const data = enc.encode(msg);
      const hash = await crypto.subtle.digest('SHA-256', data);
      return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    const PRESET_PIN_HASH = '0315b4020af3eccab7706679580ac87a710d82970733b8719e70af9b57e7b9e6'; // PIN = 4242 (podmieÅ„ hash)
    const PIN_KEY  = 'cravers_pin_hash';
    const AUTH_KEY = 'cravers_auth_token';

    function nowMs(){ return Date.now(); }
    function setAuthToken(token, days=30){
      const until = nowMs() + days*24*3600*1000;
      localStorage.setItem(AUTH_KEY, JSON.stringify({token, until}));
    }
    function clearAuth(){ localStorage.removeItem(AUTH_KEY); }
    function getAuth(){
      try {
        const raw = localStorage.getItem(AUTH_KEY);
        if (!raw) return null;
        const obj = JSON.parse(raw);
        if (!obj.until || nowMs() > obj.until) {
          localStorage.removeItem(AUTH_KEY);
          return null;
        }
        return obj;
      } catch { return null; }
    }
    function isAuthed(){ return !!getAuth(); }

    const lock = document.getElementById('cr_lock');
    const pinInput = document.getElementById('pinInput');
    const rememberCheck = document.getElementById('rememberCheck');
    const unlockBtn = document.getElementById('unlockBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const lockMsg = document.getElementById('lockMsg');

    async function setupLock(){
      if (!localStorage.getItem(PIN_KEY)) localStorage.setItem(PIN_KEY, PRESET_PIN_HASH);
      if (isAuthed()) {
        lock.classList.add('hidden');
      } else {
        lock.classList.remove('hidden');
      }
    }

    unlockBtn.onclick = async () => {
      lockMsg.textContent = '';
      const val = pinInput.value.trim();
      if (!val) { lockMsg.textContent='Wpisz PIN'; return; }
      const h = await sha256hex(val);
      const stored = localStorage.getItem(PIN_KEY);
      if (h === stored) {
        setAuthToken(h, rememberCheck.checked ? 30 : 0.08); // ~2h gdy bez "zapamiÄ™taj"
        lock.classList.add('hidden');
        pinInput.value='';
      } else {
        lockMsg.textContent='BÅ‚Ä™dny PIN';
      }
    };

    logoutBtn.onclick = () => {
      clearAuth();
      lock.classList.remove('hidden');
    };

    setupLock();

    // Service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () =>
        navigator.serviceWorker.register('/service-worker.js').catch(()=>{})
      );
    }
  </script>
</body>
</html>











