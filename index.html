<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cravers</title>

  <!-- iOS PWA fullscreen -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="/icons/icon-192.png" />

  <!-- Manifest PWA -->
  <link rel="manifest" href="/manifest.json" />

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .tile { transition: transform .12s ease, box-shadow .12s ease; }
    .tile:active, .tile:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,.15); }
  </style>
</head>
<body class="min-h-screen bg-slate-950 text-slate-50">
  <!-- LOCK: PIN narzucony z gÃ³ry -->
  <div id="cr_lock" class="fixed inset-0 hidden items-center justify-center bg-black/90 z-[9999]">
    <div class="w-[360px] max-w-[92%] p-6 rounded-xl bg-slate-900 text-center shadow-2xl">
      <img src="/icons/icon-192.png" class="w-14 mx-auto mb-2" alt="">
      <h2 class="text-lg font-semibold mb-2">Cravers â€” dostÄ™p</h2>
      <div id="loginWrap">
        <p class="text-xs text-slate-400 mb-2">Wpisz PIN</p>
        <input id="pinInput" inputmode="numeric" placeholder="PIN"
               class="w-full text-lg px-3 py-2 rounded-lg bg-slate-800 border border-white/10 mb-2 outline-none">
        <label class="flex items-center justify-center gap-2 text-xs text-slate-400 mb-2 select-none">
          <input id="rememberCheck" type="checkbox"> ZapamiÄ™taj na 30 dni
        </label>
        <div class="flex justify-center gap-2">
          <button id="unlockBtn" class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 font-semibold">WejdÅº</button>
          <button id="logoutBtn" class="px-4 py-2 rounded-lg bg-slate-700">Wyloguj</button>
        </div>
        <p id="lockMsg" class="mt-2 text-rose-300 text-sm"></p>
      </div>
      <p class="mt-3 text-xs text-slate-500">ZapomniaÅ‚eÅ› PIN? WyczyÅ›Ä‡ dane witryny / localStorage.</p>
    </div>
  </div>

  <!-- APP -->
  <div class="mx-auto max-w-5xl px-4 py-6 sm:py-10">
    <header class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <img src="/icons/icon-192.png" class="h-10 w-10 rounded-xl" alt="Cravers">
        <div>
          <h1 class="text-2xl font-bold tracking-tight">Cravers Hub</h1>
          <p class="text-sm text-slate-400">Panel wewnÄ™trzny â€¢ Oferty â€¢ Umowy â€¢ Wydruki</p>
        </div>
      </div>
      <nav class="hidden sm:flex gap-2">
        <a href="#/" class="px-3 py-1 rounded-lg bg-slate-800/70 ring-1 ring-white/10">Start</a>
        <a href="#/oferty" class="px-3 py-1 rounded-lg bg-slate-800/70 ring-1 ring-white/10">Oferty</a>
        <a href="#/podpisz" class="px-3 py-1 rounded-lg bg-slate-800/70 ring-1 ring-white/10">Podpisz umowÄ™</a>
        <a href="#/ustalenia" class="px-3 py-1 rounded-lg bg-slate-800/70 ring-1 ring-white/10">Ustalenia weselne</a>
        <a href="#/drukuj" class="px-3 py-1 rounded-lg bg-slate-800/70 ring-1 ring-white/10">Drukuj</a>
      </nav>
    </header>

    <main id="view" class="mt-6"></main>
 </div>

  <script>
    /************* KONFIG â€“ PODMIENISZ TYLKO TE LINKI *************/
    const LINKS = {
      oferty: {
        wesele: { 2026: 'https://...pdf', 2027: 'https://...pdf', 2028: 'https://...pdf' },
        studniowka: { 2026: 'https://...pdf', 2027: 'https://...pdf', 2028: 'https://...pdf' },
      },
      podpisz: {
        weselna: 'https://docs.google.com/forms/...', // Google Form
        inna: 'https://docs.google.com/forms/...',    // Google Form
      },
      ustalenia: {
        form: 'https://docs.google.com/forms/...', // ten sam link do â€žPrzeprowadÅº samâ€ i do kopiowania
      },
      drukuj: {
        oferty: {
          wesele: { 2026: {url: 'https://...pdf', action: 'preview'},
                    2027: {url: 'https://...pdf', action: 'preview'},
                    2028: {url: 'https://...pdf', action: 'preview'} },
          studniowka: { 2026: {url: 'https://...pdf', action: 'preview'},
                        2027: {url: 'https://...pdf', action: 'preview'},
                        2028: {url: 'https://...pdf', action: 'preview'} },
        },
        czysteUmowy: {
          weselna: {url: 'https://...pdf', action: 'preview'},
          inna:    {url: 'https://...pdf', action: 'preview'},
        },
        ustaleniaWeselne: {url: 'https://...pdf', action: 'preview'},
        scenariusz:       {url: 'https://...pdf', action: 'preview'},
      }
    };
    /**************************************************************/

    // POMOCNIKI UI
    const el = (tag, cls, html) => { const e = document.createElement(tag); if(cls) e.className = cls; if(html!=null) e.innerHTML = html; return e; };
    function tile(label, sub, onclick, gradient='from-sky-600 to-sky-800', emoji='ðŸ“„') {
      const b = el('button', `tile rounded-3xl bg-gradient-to-br ${gradient} p-5 text-left w-full`);
      b.onclick = onclick;
      b.append(el('div', 'text-3xl', emoji));
      b.append(el('div', 'mt-2 text-lg font-semibold', label));
      if(sub) b.append(el('div', 'text-white/80 text-sm', sub));
      return b;
    }
    function listLink(label, href, {action='preview'} = {}) {
      const a = el('a', 'block px-4 py-3 rounded-xl bg-slate-800/70 ring-1 ring-white/10 hover:bg-slate-800');
      a.textContent = label;
      a.href = action === 'print' ? `print.html?src=${encodeURIComponent(href)}` : href;
      return a;
    }
    function section(title){ const d = el('div','mb-6'); d.append(el('h3','text-base font-semibold mb-2', title)); return d; }
    const view = document.getElementById('view');

    // ROUTER
    function go(hash){ location.hash = hash; }
    window.addEventListener('hashchange', render);
    render();

    function render(){
      const h = location.hash || '#/';
      view.innerHTML = '';
      if(h === '#/' || h === '#') return renderHome();
      if(h === '#/oferty') return renderOferty();
      if(h.startsWith('#/oferty/wesele')) return renderOfertyRok('wesele');
      if(h.startsWith('#/oferty/studniowka')) return renderOfertyRok('studniowka');
      if(h === '#/podpisz') return renderPodpisz();
      if(h === '#/ustalenia') return renderUstalenia();
      if(h === '#/drukuj') return renderDrukuj();
      view.textContent = 'Nie znaleziono strony.';
    }

    function renderHome(){
      const grid = el('div','grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3');
      grid.append(
        tile('Oferty','Wesele / StudniÃ³wka', ()=>go('#/oferty'),'from-sky-600 to-sky-800','ðŸ’¼'),
        tile('Podpisz umowÄ™','Weselna / Inna', ()=>go('#/podpisz'),'from-emerald-600 to-emerald-800','âœï¸'),
        tile('Ustalenia weselne','PrzeprowadÅº sam / Kopiuj link', ()=>go('#/ustalenia'),'from-fuchsia-600 to-fuchsia-800','ðŸ’'),
        tile('Drukuj','Oferty, Czyste umowy, Ustalenia, Scenariusz', ()=>go('#/drukuj'),'from-amber-600 to-amber-800','ðŸ–¨ï¸')
      );
      view.append(grid);
    }

    function renderOferty(){
      const grid = el('div','grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3');
      grid.append(
        tile('Wesele','2026 / 2027 / 2028', ()=>go('#/oferty/wesele'),'from-indigo-600 to-indigo-800','ðŸ’’'),
        tile('StudniÃ³wka','2026 / 2027 / 2028', ()=>go('#/oferty/studniowka'),'from-rose-600 to-rose-800','ðŸŽ“')
      );
      view.append(grid);
    }
    function renderOfertyRok(type){
      const years = Object.keys(LINKS.oferty[type]);
      const box = el('div','space-y-2');
      years.forEach(y=>{
        const url = LINKS.oferty[type][y];
        if(url && url.startsWith('http')) box.append(listLink(`${type==='wesele'?'Wesele':'StudniÃ³wka'} ${y}`, url));
      });
      view.append(el('h2','text-xl font-semibold mb-3', type==='wesele'?'Oferty â€” Wesele':'Oferty â€” StudniÃ³wka'));
      view.append(box);
    }

    function renderPodpisz(){
      const grid = el('div','grid grid-cols-1 gap-4 sm:grid-cols-2');
      grid.append(
        tile('Weselna','Formularz Google', ()=>openSameTab(LINKS.podpisz.weselna),'from-emerald-600 to-emerald-800','ðŸ“'),
        tile('Inna','Formularz Google', ()=>openSameTab(LINKS.podpisz.inna),'from-sky-600 to-sky-800','ðŸ“')
      );
      view.append(grid);
    }

    function renderUstalenia(){
      const wrap = el('div','grid grid-cols-1 gap-4 sm:grid-cols-2');
      wrap.append(
        tile('PrzeprowadÅº sam','OtwÃ³rz formularz', ()=>openSameTab(LINKS.ustalenia.form),'from-fuchsia-600 to-fuchsia-800','ðŸ§©'),
        tile('Kopiuj link','Skopiuj do schowka', ()=>copyLink(LINKS.ustalenia.form),'from-amber-600 to-amber-800','ðŸ”—')
      );
      view.append(wrap);
      view.append(el('p','text-xs text-slate-400 mt-2','Po skopiowaniu moÅ¼esz wkleiÄ‡ link klientowi w SMS/Messenger.'));
    }

    function renderDrukuj(){
      // Oferty
      view.append(el('h2','text-xl font-semibold mb-3','Drukuj'));
      const s1 = section('Oferty â€” Wesele');
      const s2 = section('Oferty â€” StudniÃ³wka');
      Object.entries(LINKS.drukuj.oferty.wesele).forEach(([y,obj])=>{
        if(obj?.url) s1.append(listLink(`Wesele ${y}`, obj.url, obj));
      });
      Object.entries(LINKS.drukuj.oferty.studniowka).forEach(([y,obj])=>{
        if(obj?.url) s2.append(listLink(`StudniÃ³wka ${y}`, obj.url, obj));
      });
      view.append(s1); view.append(s2);

      // Czyste umowy
      const s3 = section('Czyste umowy');
      if(LINKS.drukuj.czysteUmowy.weselna?.url) s3.append(listLink('Weselna', LINKS.drukuj.czysteUmowy.weselna.url, LINKS.drukuj.czysteUmowy.weselna));
      if(LINKS.drukuj.czysteUmowy.inna?.url)    s3.append(listLink('Inna',    LINKS.drukuj.czysteUmowy.inna.url,    LINKS.drukuj.czysteUmowy.inna));
      view.append(s3);

      // Ustalenia / Scenariusz
      const s4 = section('Ustalenia weselne');
      if(LINKS.drukuj.ustaleniaWeselne?.url) s4.append(listLink('Ustalenia weselne', LINKS.drukuj.ustaleniaWeselne.url, LINKS.drukuj.ustaleniaWeselne));
      view.append(s4);

      const s5 = section('PrzykÅ‚adowy scenariusz');
      if(LINKS.drukuj.scenariusz?.url) s5.append(listLink('Scenariusz', LINKS.drukuj.scenariusz.url, LINKS.drukuj.scenariusz));
      view.append(s5);
    }

    function openSameTab(url){
      if(!url) return alert('Brak linku.');
      location.href = url; // w PWA to bÄ™dzie fullscreen
    }
    async function copyLink(url){
      if(!url) return alert('Brak linku.');
      try {
        await navigator.clipboard.writeText(url);
        toast('Skopiowano link âœ…');
      } catch {
        prompt('Skopiuj rÄ™cznie:', url);
      }
    }
    function toast(txt){
      const t = el('div','fixed bottom-4 left-1/2 -translate-x-1/2 bg-slate-900/90 text-white px-4 py-2 rounded-xl ring-1 ring-white/10 shadow');
      t.textContent = txt; document.body.append(t);
      setTimeout(()=>t.remove(), 1800);
    }

    // PRINT helper page (inline)
    // JeÅ›li nie masz osobnego pliku print.html na StackBlitz, to niÅ¼ej tworzÄ™ go w locie:
    (function ensurePrintHelper(){
      if(!location.origin.includes('stackblitz')) return; // tylko dev
      const blob = new Blob([`
        <!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Drukuj</title></head>
        <body style="margin:0;height:100vh;background:#000">
          <iframe id="pdf" style="border:0;width:100%;height:100%"></iframe>
          <script>
            const u = new URL(location.href);
            const src = u.searchParams.get('src');
            const fr = document.getElementById('pdf');
            fr.onload = () => setTimeout(()=>window.print(), 350);
            fr.src = src;
          <\/script>
        </body></html>
      `], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      window.printHelperURL = url; // do debug
    })();

    /******************* PIN (narzucony) â€” zapamiÄ™taj 30 dni *******************/
    async function sha256hex(msg) {
      const enc = new TextEncoder();
      const data = enc.encode(msg);
      const hash = await crypto.subtle.digest('SHA-256', data);
      return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
    }
    const PRESET_PIN_HASH = '0315b4020af3eccab7706679580ac87a710d82970733b8719e70af9b57e7b9e6'; // PIN = 4242 (podmieÅ„ hash)
    const PIN_KEY  = 'cravers_pin_hash';
    const AUTH_KEY = 'cravers_auth_token';
    function nowMs(){ return Date.now(); }
    function setAuthToken(token, days=30){ const until = nowMs()+days*24*3600*1000; localStorage.setItem(AUTH_KEY, JSON.stringify({token, until})); }
    function clearAuth(){ localStorage.removeItem(AUTH_KEY); }
    function getAuth(){ try{const raw=localStorage.getItem(AUTH_KEY); if(!raw) return null; const obj=JSON.parse(raw); if(!obj.until||nowMs()>obj.until){localStorage.removeItem(AUTH_KEY); return null;} return obj;}catch{return null;} }
    function isAuthed(){ return !!getAuth(); }

    const lock = document.getElementById('cr_lock');
    const pinInput = document.getElementById('pinInput');
    const rememberCheck = document.getElementById('rememberCheck');
    const unlockBtn = document.getElementById('unlockBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const lockMsg = document.getElementById('lockMsg');

    async function setupLock(){
      if(!localStorage.getItem(PIN_KEY)) localStorage.setItem(PIN_KEY, PRESET_PIN_HASH);
      if(isAuthed()){ lock.classList.add('hidden'); } else { lock.classList.remove('hidden'); }
    }
    unlockBtn.onclick = async () => {
      lockMsg.textContent='';
      const val = pinInput.value.trim();
      if(!val) { lockMsg.textContent='Wpisz PIN'; return; }
      const h = await sha256hex(val);
      const stored = localStorage.getItem(PIN_KEY);
      if(h === stored){ setAuthToken(h, rememberCheck.checked ? 30 : 0.08); lock.classList.add('hidden'); pinInput.value=''; }
      else lockMsg.textContent='BÅ‚Ä™dny PIN';
    };
    logoutBtn.onclick = () => { clearAuth(); lock.classList.remove('hidden'); };

    setupLock();

    // Service worker
    if('serviceWorker' in navigator){
      window.addEventListener('load', ()=>navigator.serviceWorker.register('/service-worker.js').catch(()=>{}));
    }
  </script>
</body>
</html>

